import{store as e,getContext as t,getElement as n,getConfig as o,withScope as r}from"@wordpress/interactivity";import{computePosition as s,autoUpdate as a,offset as i}from"//cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.9/+esm";if(void 0===s)throw new TypeError("WeCodeArt's Dropdown require Floating UI (https://floating-ui.com/)");const{fn:{isRTL:c,isVisible:d,isElement:l,isDisabled:u,getNextActiveElement:p,executeAfterTransition:f,getOptions:m,getElement:g,validateConfig:T,noop:w},Events:y,Selector:P}=wecodeart,b="dropdown",h=`wecodeart/${b}`,O=`.${`wp.${b}`}`,E=".data-api",v="ArrowUp",k="ArrowDown",x=`hide${O}`,M=`hidden${O}`,$=`show${O}`,L=`shown${O}`,A=`click${O}${E}`,N=`keydown${O}${E}`,C=`keyup${O}${E}`,D="show",R=`[data-wp-interactive="${h}"]:not(.disabled):not(:disabled)`,B=`${R}.${D}`,I=".dropdown-menu",H={TOP:c()?"top-end":"top-start",TOPCENTER:"top",TOPEND:c()?"top-start":"top-end",RIGHT:c()?"left-start":"right-start",BOTTOM:c()?"bottom-end":"bottom-start",BOTTOMEND:c()?"bottom-start":"bottom-end",BOTTOMCENTER:"bottom",LEFT:c()?"right-start":"left-start"},{state:j,actions:F,callbacks:G}=e(h,{state:{},actions:{toggle:()=>{const{ref:e}=n();return e.classList.contains(D)?F.hide():F.show()},show:e=>{const{ref:o}=e?{ref:e.target}:n();if(u(o)||o.classList.contains(D))return;const s={relatedTarget:o},i=G.getMenu(o);if(y.trigger(o,$,s).defaultPrevented)return;G.createPopper();if(t().cleanup=a(o,i,r(G.createPopper)),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))y.on(e,"mouseover",w);o.focus(),o.setAttribute("aria-expanded",!0),o.classList.add(D),i.classList.add(D);const c=r((()=>y.trigger(o,L,s)));f(c,i)},hide:e=>{const{ref:t}=e?{ref:e.target}:n();if(u(t)||!t.classList.contains(D))return;const o={relatedTarget:t};G.completeHide(o)},clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return;const t=P.find(B);for(const n of t){const t={...j,...m(n.dataset.wpContext)};if(!t||!1===t?.autoClose)continue;const o=e.composedPath(),r=G.getMenu(n),s=o.includes(r);if(o.includes(n)||"inside"===t.autoClose&&!s||"outside"===t.autoClose&&s)continue;if(r.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const a={relatedTarget:n};"click"===e.type&&(a.clickEvent=e),G.completeHide(a)}},keydown(e){const t=e.target,n=/input|textarea/i.test(t.tagName),o="Escape"===e.key,r=[v,k].includes(e.key);if(!r&&!o)return;if(n&&!o)return;e.preventDefault();const s=t.matches(R)?t:P.prev(t,R)[0]||P.next(t,R)[0]||P.findOne(R,e.delegateTarget.parentNode);if(r)return e.stopPropagation(),F.show({target:s}),void G.selectMenuItem(e);s.classList.contains(D)&&(e.stopPropagation(),F.hide({target:s}),s.focus())}},callbacks:{completeHide:e=>{const{relatedTarget:t}=e,n=G.getMenu(t);if(y.trigger(t,x,t).defaultPrevented)return;if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))y.off(e,"mouseover",w);r((()=>G.disposePopper())),n.classList.remove(D),t.classList.remove(D),t.setAttribute("aria-expanded","false");const o=r((()=>y.trigger(t,M,t)));f(o,n)},createPopper:()=>{const{ref:e}=n(),o=G.getMenu();let r=e;const{reference:a}={...j,...t()};"parent"===a?r=G.getParent():l(a)?r=g(a):"object"==typeof a&&(r=a);const c={name:"setPlacement",fn:({placement:e})=>(o.setAttribute("data-placement",e),{})};return s(r,o,{placement:G.getPlacement(),middleware:[i({...G.getOffset()}),c].filter(Boolean)}).then((({x:e,y:t})=>{Object.assign(o.style,{position:"absolute",inset:"auto",margin:"0",top:"0",left:"0",transform:`translate3d(${G.roundByDPR(e)}px,${G.roundByDPR(t)}px,0)`})}))},disposePopper:()=>{const e=t();e.cleanup&&(e.cleanup(),e.cleanup=null)},getParent:e=>{const{ref:t}=e?{ref:e}:n();return t.parentNode},getMenu:e=>{const{ref:t}=e?{ref:e}:n();return P.next(t,I)[0]||P.prev(t,I)[0]||P.findOne(I,G.getParent(t))},selectMenuItem({key:e,target:t}){const n=t.closest(I)||G.getMenu(t),o=P.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",n).filter((e=>d(e)));o.length&&p(o,t,e===k,!o.includes(t)).focus()},getOffset(){let{offset:e=j.offset}=t();switch("string"==typeof e&&(e=e.split(",").map((e=>Number.parseInt(e,10)))),e.length){case 1:e={mainAxis:e[0]};break;case 2:e={mainAxis:e[0],crossAxis:e[1]};break;case 3:e={mainAxis:e[0],crossAxis:e[1],alignmentAxis:e[2]}}return e},getPlacement(){const e=G.getParent();if(e.classList.contains("dropend"))return H.RIGHT;if(e.classList.contains("dropstart"))return H.LEFT;if(e.classList.contains("dropup-center"))return H.TOPCENTER;if(e.classList.contains("dropdown-center"))return H.BOTTOMCENTER;const t="end"===getComputedStyle(G.getMenu()).getPropertyValue("--wp--position").trim();return e.classList.contains("dropup")?t?H.TOPEND:H.TOP:t?H.BOTTOMEND:H.BOTTOM},roundByDPR:e=>{const t=window.devicePixelRatio||1;return Math.round(e*t)/t},validateConfig:()=>T(b,{...j,...t()},o(h))}});y.on(document,N,R,F.keydown),y.on(document,N,I,F.keydown),y.on(document,A,F.clearMenus),y.on(document,C,F.clearMenus);