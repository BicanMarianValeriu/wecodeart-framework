import{store,getContext,getElement,getConfig,withScope}from"@wordpress/interactivity";import{computePosition,autoUpdate,offset}from"//cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.9/+esm";if(void 0===computePosition)throw new TypeError("WeCodeArt's Dropdown require Floating UI (https://floating-ui.com/)");let{fn:{isRTL,isVisible,isElement,isDisabled,getNextActiveElement,executeAfterTransition,getOptions,getElement:getDOMElement,validateConfig,noop},Events,Selector}=wecodeart;const NAME="dropdown",NAMESPACE="wecodeart/"+NAME,DATA_KEY="wp."+NAME,EVENT_KEY="."+DATA_KEY,DATA_API_KEY=".data-api",ESCAPE_KEY="Escape",TAB_KEY="Tab",ARROW_UP_KEY="ArrowUp",ARROW_DOWN_KEY="ArrowDown",RIGHT_MOUSE_BUTTON=2,EVENT_HIDE="hide"+EVENT_KEY,EVENT_HIDDEN="hidden"+EVENT_KEY,EVENT_SHOW="show"+EVENT_KEY,EVENT_SHOWN="shown"+EVENT_KEY,EVENT_CLICK_DATA_API="click"+EVENT_KEY+DATA_API_KEY,EVENT_KEYDOWN_DATA_API="keydown"+EVENT_KEY+DATA_API_KEY,EVENT_KEYUP_DATA_API="keyup"+EVENT_KEY+DATA_API_KEY,CLASS_NAME_SHOW="show",CLASS_NAME_DROPUP="dropup",CLASS_NAME_DROPEND="dropend",CLASS_NAME_DROPSTART="dropstart",CLASS_NAME_DROPUP_CENTER="dropup-center",CLASS_NAME_DROPDOWN_CENTER="dropdown-center",SELECTOR_DATA_TOGGLE=`[data-wp-interactive="${NAMESPACE}"]:not(.disabled):not(:disabled)`,SELECTOR_DATA_TOGGLE_SHOWN=SELECTOR_DATA_TOGGLE+"."+CLASS_NAME_SHOW,SELECTOR_MENU=".dropdown-menu",SELECTOR_VISIBLE_ITEMS=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",AttachmentMap={TOP:isRTL()?"top-end":"top-start",TOPCENTER:"top",TOPEND:isRTL()?"top-start":"top-end",RIGHT:isRTL()?"left-start":"right-start",BOTTOM:isRTL()?"bottom-end":"bottom-start",BOTTOMEND:isRTL()?"bottom-start":"bottom-end",BOTTOMCENTER:"bottom",LEFT:isRTL()?"right-start":"left-start"};let{state,actions,callbacks}=store(NAMESPACE,{state:{},actions:{toggle:()=>{var e=getElement().ref;return e.classList.contains(CLASS_NAME_SHOW)?actions.hide():actions.show()},show:e=>{let t=(e?{ref:e.target}:getElement()).ref;if(!isDisabled(t)&&!t.classList.contains(CLASS_NAME_SHOW)){const n={relatedTarget:t};var e=callbacks.getMenu(t),a=Events.trigger(t,EVENT_SHOW,n);if(!a.defaultPrevented){if(callbacks.createPopper(),getContext().cleanup=autoUpdate(t,e,withScope(callbacks.createPopper)),"ontouchstart"in document.documentElement)for(const o of[].concat(...document.body.children))Events.on(o,"mouseover",noop);t.focus(),t.setAttribute("aria-expanded",!0),t.classList.add(CLASS_NAME_SHOW),e.classList.add(CLASS_NAME_SHOW);a=withScope(()=>Events.trigger(t,EVENT_SHOWN,n));executeAfterTransition(a,e)}}},hide:e=>{var e=(e?{ref:e.target}:getElement()).ref;!isDisabled(e)&&e.classList.contains(CLASS_NAME_SHOW)&&(e={relatedTarget:e},callbacks.completeHide(e))},clearMenus(e){if(e.button!==RIGHT_MOUSE_BUTTON&&("keyup"!==e.type||e.key===TAB_KEY))for(const s of Selector.find(SELECTOR_DATA_TOGGLE_SHOWN)){var t,a,n,o={...state,...getOptions(s.dataset.wpContext)};!1===o.autoClose||(n=e.composedPath(),t=callbacks.getMenu(s),a=n.includes(t),n.includes(s))||"inside"===o.autoClose&&!a||"outside"===o.autoClose&&a||t.contains(e.target)&&("keyup"===e.type&&e.key===TAB_KEY||/input|select|option|textarea|form/i.test(e.target.tagName))||(n={relatedTarget:s},"click"===e.type&&(n.clickEvent=e),callbacks.completeHide(n))}},keydown(e){var t=e.target,a=/input|textarea/i.test(t.tagName),n=e.key===ESCAPE_KEY,o=[ARROW_UP_KEY,ARROW_DOWN_KEY].includes(e.key);!o&&!n||a&&!n||(e.preventDefault(),a=t.matches(SELECTOR_DATA_TOGGLE)?t:Selector.prev(t,SELECTOR_DATA_TOGGLE)[0]||Selector.next(t,SELECTOR_DATA_TOGGLE)[0]||Selector.findOne(SELECTOR_DATA_TOGGLE,e.delegateTarget.parentNode),o?(e.stopPropagation(),actions.show({target:a}),callbacks.selectMenuItem(e)):a.classList.contains(CLASS_NAME_SHOW)&&(e.stopPropagation(),actions.hide({target:a}),a.focus()))}},callbacks:{completeHide:e=>{let t=e.relatedTarget;var e=callbacks.getMenu(t),a=Events.trigger(t,EVENT_HIDE,t);if(!a.defaultPrevented){if("ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))Events.off(n,"mouseover",noop);withScope(()=>callbacks.disposePopper()),e.classList.remove(CLASS_NAME_SHOW),t.classList.remove(CLASS_NAME_SHOW),t.setAttribute("aria-expanded","false");a=withScope(()=>Events.trigger(t,EVENT_HIDDEN,t));executeAfterTransition(a,e)}},createPopper:()=>{var e=getElement().ref;const a=callbacks.getMenu();let t=e;e={...state,...getContext()}.reference,"parent"===e?t=callbacks.getParent():isElement(e)?t=getDOMElement(e):"object"==typeof e&&(t=e),e={name:"setPlacement",fn({placement:e}){return a.setAttribute("data-placement",e),{}}};return computePosition(t,a,{placement:callbacks.getPlacement(),middleware:[offset({...callbacks.getOffset()}),e].filter(Boolean)}).then(({x:e,y:t})=>{Object.assign(a.style,{position:"absolute",inset:"auto",margin:"0",top:"0",left:"0",transform:`translate3d(${callbacks.roundByDPR(e)}px,${callbacks.roundByDPR(t)}px,0)`})})},disposePopper:()=>{var e=getContext();e.cleanup&&(e.cleanup(),e.cleanup=null)},getParent:e=>{e=(e?{ref:e}:getElement()).ref;return e.parentNode},getMenu:e=>{e=(e?{ref:e}:getElement()).ref;return Selector.next(e,SELECTOR_MENU)[0]||Selector.prev(e,SELECTOR_MENU)[0]||Selector.findOne(SELECTOR_MENU,callbacks.getParent(e))},selectMenuItem({key:e,target:t}){var a=t.closest(SELECTOR_MENU)||callbacks.getMenu(t),a=Selector.find(SELECTOR_VISIBLE_ITEMS,a).filter(e=>isVisible(e));a.length&&getNextActiveElement(a,t,e===ARROW_DOWN_KEY,!a.includes(t)).focus()},getOffset(){let{offset:e=state.offset}=getContext();switch((e="string"==typeof e?e.split(",").map(e=>Number.parseInt(e,10)):e).length){case 1:e={mainAxis:e[0]};break;case 2:e={mainAxis:e[0],crossAxis:e[1]};break;case 3:e={mainAxis:e[0],crossAxis:e[1],alignmentAxis:e[2]}}return e},getPlacement(){var e,t=callbacks.getParent();return t.classList.contains(CLASS_NAME_DROPEND)?AttachmentMap.RIGHT:t.classList.contains(CLASS_NAME_DROPSTART)?AttachmentMap.LEFT:t.classList.contains(CLASS_NAME_DROPUP_CENTER)?AttachmentMap.TOPCENTER:t.classList.contains(CLASS_NAME_DROPDOWN_CENTER)?AttachmentMap.BOTTOMCENTER:(e="end"===getComputedStyle(callbacks.getMenu()).getPropertyValue("--wp--position").trim(),t.classList.contains(CLASS_NAME_DROPUP)?e?AttachmentMap.TOPEND:AttachmentMap.TOP:e?AttachmentMap.BOTTOMEND:AttachmentMap.BOTTOM)},roundByDPR:e=>{var t=window.devicePixelRatio||1;return Math.round(e*t)/t},validateConfig:()=>validateConfig(NAME,{...state,...getContext()},getConfig(NAMESPACE))}});Events.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_DATA_TOGGLE,actions.keydown),Events.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_MENU,actions.keydown),Events.on(document,EVENT_CLICK_DATA_API,actions.clearMenus),Events.on(document,EVENT_KEYUP_DATA_API,actions.clearMenus);