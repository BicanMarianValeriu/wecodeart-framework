import{store,getContext,getElement,getConfig,withScope}from"@wordpress/interactivity";import{computePosition,autoUpdate,offset}from"//cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.9/+esm";if(void 0===computePosition)throw new TypeError("WeCodeArt's Dropdown require Floating UI (https://floating-ui.com/)");const{fn:{isRTL:isRTL,isVisible:isVisible,isElement:isElement,isDisabled:isDisabled,getNextActiveElement:getNextActiveElement,executeAfterTransition:executeAfterTransition,getOptions:getOptions,getElement:getDOMElement,validateConfig:validateConfig,noop:noop},Events:Events,Selector:Selector}=wecodeart,NAME="dropdown",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,DATA_API_KEY=".data-api",ESCAPE_KEY="Escape",TAB_KEY="Tab",ARROW_UP_KEY="ArrowUp",ARROW_DOWN_KEY="ArrowDown",RIGHT_MOUSE_BUTTON=2,EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,EVENT_CLICK_DATA_API=`click${EVENT_KEY}.data-api`,EVENT_KEYDOWN_DATA_API=`keydown${EVENT_KEY}.data-api`,EVENT_KEYUP_DATA_API=`keyup${EVENT_KEY}.data-api`,CLASS_NAME_SHOW="show",CLASS_NAME_DROPUP="dropup",CLASS_NAME_DROPEND="dropend",CLASS_NAME_DROPSTART="dropstart",CLASS_NAME_DROPUP_CENTER="dropup-center",CLASS_NAME_DROPDOWN_CENTER="dropdown-center",SELECTOR_DATA_TOGGLE=`[data-wp-interactive="${NAMESPACE}"]:not(.disabled):not(:disabled)`,SELECTOR_DATA_TOGGLE_SHOWN=`${SELECTOR_DATA_TOGGLE}.show`,SELECTOR_MENU=".dropdown-menu",SELECTOR_VISIBLE_ITEMS=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",AttachmentMap={TOP:isRTL()?"top-end":"top-start",TOPCENTER:"top",TOPEND:isRTL()?"top-start":"top-end",RIGHT:isRTL()?"left-start":"right-start",BOTTOM:isRTL()?"bottom-end":"bottom-start",BOTTOMEND:isRTL()?"bottom-start":"bottom-end",BOTTOMCENTER:"bottom",LEFT:isRTL()?"right-start":"left-start"},{state:state,actions:actions,callbacks:callbacks}=store(NAMESPACE,{state:{},actions:{toggle:()=>{const{ref:t}=getElement();return t.classList.contains("show")?actions.hide():actions.show()},show:t=>{const{ref:e}=t?{ref:t.target}:getElement();if(isDisabled(e)||e.classList.contains("show"))return;const n={relatedTarget:e},o=callbacks.getMenu(e);if(Events.trigger(e,EVENT_SHOW,n).defaultPrevented)return;callbacks.createPopper();if(getContext().cleanup=autoUpdate(e,o,withScope(callbacks.createPopper)),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))Events.on(t,"mouseover",noop);e.focus(),e.setAttribute("aria-expanded",!0),e.classList.add("show"),o.classList.add("show");const s=withScope((()=>Events.trigger(e,EVENT_SHOWN,n)));executeAfterTransition(s,o)},hide:t=>{const{ref:e}=t?{ref:t.target}:getElement();if(isDisabled(e)||!e.classList.contains("show"))return;const n={relatedTarget:e};callbacks.completeHide(n)},clearMenus(t){if(2===t.button||"keyup"===t.type&&"Tab"!==t.key)return;const e=Selector.find(SELECTOR_DATA_TOGGLE_SHOWN);for(const n of e){const e={...state,...getOptions(n.dataset.wpContext)};if(!e||!1===e?.autoClose)continue;const o=t.composedPath(),s=callbacks.getMenu(n),a=o.includes(s);if(o.includes(n)||"inside"===e.autoClose&&!a||"outside"===e.autoClose&&a)continue;if(s.contains(t.target)&&("keyup"===t.type&&"Tab"===t.key||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const c={relatedTarget:n};"click"===t.type&&(c.clickEvent=t),callbacks.completeHide(c)}},keydown(t){const e=t.target,n=/input|textarea/i.test(e.tagName),o="Escape"===t.key,s=[ARROW_UP_KEY,ARROW_DOWN_KEY].includes(t.key);if(!s&&!o)return;if(n&&!o)return;t.preventDefault();const a=e.matches(SELECTOR_DATA_TOGGLE)?e:Selector.prev(e,SELECTOR_DATA_TOGGLE)[0]||Selector.next(e,SELECTOR_DATA_TOGGLE)[0]||Selector.findOne(SELECTOR_DATA_TOGGLE,t.delegateTarget.parentNode);if(s)return t.stopPropagation(),actions.show({target:a}),void callbacks.selectMenuItem(t);a.classList.contains("show")&&(t.stopPropagation(),actions.hide({target:a}),a.focus())}},callbacks:{completeHide:t=>{const{relatedTarget:e}=t,n=callbacks.getMenu(e);if(Events.trigger(e,EVENT_HIDE,e).defaultPrevented)return;if("ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))Events.off(t,"mouseover",noop);withScope((()=>callbacks.disposePopper())),n.classList.remove("show"),e.classList.remove("show"),e.setAttribute("aria-expanded","false");const o=withScope((()=>Events.trigger(e,EVENT_HIDDEN,e)));executeAfterTransition(o,n)},createPopper:()=>{const{ref:t}=getElement(),e=callbacks.getMenu();let n=t;const{reference:o}={...state,...getContext()};"parent"===o?n=callbacks.getParent():isElement(o)?n=getDOMElement(o):"object"==typeof o&&(n=o);const s={name:"setPlacement",fn:({placement:t})=>(e.setAttribute("data-placement",t),{})};return computePosition(n,e,{placement:callbacks.getPlacement(),middleware:[offset({...callbacks.getOffset()}),s].filter(Boolean)}).then((({x:t,y:n})=>{Object.assign(e.style,{position:"absolute",inset:"auto",margin:"0",top:"0",left:"0",transform:`translate3d(${callbacks.roundByDPR(t)}px,${callbacks.roundByDPR(n)}px,0)`})}))},disposePopper:()=>{const t=getContext();t.cleanup&&(t.cleanup(),t.cleanup=null)},getParent:t=>{const{ref:e}=t?{ref:t}:getElement();return e.parentNode},getMenu:t=>{const{ref:e}=t?{ref:t}:getElement();return Selector.next(e,SELECTOR_MENU)[0]||Selector.prev(e,SELECTOR_MENU)[0]||Selector.findOne(SELECTOR_MENU,callbacks.getParent(e))},selectMenuItem({key:t,target:e}){const n=e.closest(SELECTOR_MENU)||callbacks.getMenu(e),o=Selector.find(SELECTOR_VISIBLE_ITEMS,n).filter((t=>isVisible(t)));o.length&&getNextActiveElement(o,e,t===ARROW_DOWN_KEY,!o.includes(e)).focus()},getOffset(){let{offset:t=state.offset}=getContext();switch("string"==typeof t&&(t=t.split(",").map((t=>Number.parseInt(t,10)))),t.length){case 1:t={mainAxis:t[0]};break;case 2:t={mainAxis:t[0],crossAxis:t[1]};break;case 3:t={mainAxis:t[0],crossAxis:t[1],alignmentAxis:t[2]}}return t},getPlacement(){const t=callbacks.getParent();if(t.classList.contains("dropend"))return AttachmentMap.RIGHT;if(t.classList.contains("dropstart"))return AttachmentMap.LEFT;if(t.classList.contains("dropup-center"))return AttachmentMap.TOPCENTER;if(t.classList.contains("dropdown-center"))return AttachmentMap.BOTTOMCENTER;const e="end"===getComputedStyle(callbacks.getMenu()).getPropertyValue("--wp--position").trim();return t.classList.contains("dropup")?e?AttachmentMap.TOPEND:AttachmentMap.TOP:e?AttachmentMap.BOTTOMEND:AttachmentMap.BOTTOM},roundByDPR:t=>{const e=window.devicePixelRatio||1;return Math.round(t*e)/e},validateConfig:()=>validateConfig(NAME,{...state,...getContext()},getConfig(NAMESPACE))}});Events.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_DATA_TOGGLE,actions.keydown),Events.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_MENU,actions.keydown),Events.on(document,EVENT_CLICK_DATA_API,actions.clearMenus),Events.on(document,EVENT_KEYUP_DATA_API,actions.clearMenus);