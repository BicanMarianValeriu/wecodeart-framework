import{store as e,getContext as t,getElement as i,getConfig as r,withScope as n}from"@wordpress/interactivity";let{hooks:{applyFilters:s}}=wp,{fn:{reflow:o,isRTL:a,isVisible:E,isDisabled:l,executeAfterTransition:d,validateConfig:g},Events:c,Backdrop:A,FocusTrap:N,Selector:T,ScrollBar:p}=wecodeart,NAME="modal",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,ESCAPE_KEY="Escape",EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,CLASS_NAME_OPEN="wp-modal-open",CLASS_NAME_FADE="fade",CLASS_NAME_SHOW="show",CLASS_NAME_STATIC="wp-modal--static",SELECTOR_DIALOG=".wp-modal__dialog",SELECTOR_BODY=".wp-modal__body",{state:u,actions:S,callbacks:f}=e(NAMESPACE,{state:{current:{},get isOpen(){let{isOpen:h}=u.current;return h}},actions:{toggle(){u.isOpen?S.hide(u.current):S.show()},show(){u.isOpen&&S.hide(u.current);let e=t();if(e.isOpen||e.isTransitioning)return;let{relatedElement:r}=e,{ref:s}=i(),o=c.trigger(r,EVENT_SHOW,{relatedElement:s});!o.defaultPrevented&&(e.isOpen=!0,e.isTransitioning=!0,u._scrollBar.hide(),document.body.classList.add(CLASS_NAME_OPEN),f.adjustDialog(e),e._backdrop.show(n(f.onShow)),u.current=e)},hide(e,i){u.current={};let r=e||t();if(!r.isOpen||r.isTransitioning)return;let{relatedElement:n}=r,s=c.trigger(n,EVENT_HIDE,{relatedTarget:i});!s.defaultPrevented&&(r.isOpen=!1,r.isTransitioning=!0,r._focustrap.deactivate(),n.blur(),n.classList.remove(CLASS_NAME_SHOW),d(()=>f.onHide(r),n,f.isAnimated(r)))}},callbacks:{onShow(){let e=t(),{relatedElement:i}=e;i.style.display="block",i.removeAttribute("aria-hidden"),i.setAttribute("aria-modal",!0),i.setAttribute("role","dialog"),i.scrollTop=0;let r=T.findOne(".wp-modal__body",f.getDialog());r&&(r.scrollTop=0),o(i),i.classList.add(CLASS_NAME_SHOW);let{focus:n}=f.getConfig(),s=()=>{n&&e._focustrap.activate(),e.isTransitioning=!1,c.trigger(i,EVENT_SHOWN)};d(s,f.getDialog(),f.isAnimated())},onHide(e){let i=e||t(),{relatedElement:r}=i;r.style.display="none",r.setAttribute("aria-hidden",!0),r.removeAttribute("aria-modal"),r.removeAttribute("role"),i.isTransitioning=!1,i._backdrop.hide(()=>{document.body.classList.remove(CLASS_NAME_OPEN),f.resetAdjustments(i),u._scrollBar.reset(),c.trigger(r,EVENT_HIDDEN)})},onResize(){let{current:{isOpen:e,isTransitioning:t}}=u;e&&!t&&f.adjustDialog(u.current)},onInit(){let{backdrop:e,keyboard:r}=f.getConfig(),{ref:n}=i(),s=t(),o=T.findOne(n.getAttribute("aria-controls"));s.relatedElement=o,s._backdrop=new A({isVisible:Boolean(e),isAnimated:f.isAnimated(s)}),s._focustrap=new N({trapElement:o}),u._scrollBar=new p,c.on(o,`click.dismiss${EVENT_KEY}`,`[data-wp-close="${NAME}"]`,function(){!l(this)&&S.hide(s,this)}),c.on(o,`click.dismiss${EVENT_KEY}`,function({target:t}){if(o===t){if("static"===e){f.triggerBackdropTransition(s);return}e&&S.hide(s,"backdrop")}}),c.on(o,`keydown.dismiss${EVENT_KEY}`,({key:e})=>{if(e===ESCAPE_KEY){if(r){S.hide(s,ESCAPE_KEY);return}f.triggerBackdropTransition(s)}}),c.one(o,EVENT_SHOW,e=>{!e.defaultPrevented&&c.one(o,EVENT_HIDDEN,()=>{E(n)&&n.focus()})}),s.isOpen&&(s.isOpen=!1,S.show(s))},triggerBackdropTransition(e=t()){u.current={};let{relatedElement:i}=e,r=c.trigger(i,EVENT_HIDE_PREVENTED);if(r.defaultPrevented)return;let n=i.scrollHeight>document.documentElement.clientHeight,s=i.style.overflowY;!("hidden"===s||i.classList.contains(CLASS_NAME_STATIC))&&(n||(i.style.overflowY="hidden"),i.classList.add(CLASS_NAME_STATIC),d(()=>{i.classList.remove(CLASS_NAME_STATIC),d(()=>i.style.overflowY=s,f.getDialog(e))},f.getDialog(e)),i.focus())},isAnimated(e=t()){let{relatedElement:i}=e;return i.classList.contains("fade")},getDialog(e=t()){let{relatedElement:i}=e;return T.findOne(".wp-modal__dialog",i)},adjustDialog(e=t()){let{relatedElement:i}=e,r=i.scrollHeight>document.documentElement.clientHeight,n=u._scrollBar.getWidth(),s=n>0;if(s&&!r){let o=a()?"paddingLeft":"paddingRight";i.style[o]=`${n}px`}if(!s&&r){let E=a()?"paddingRight":"paddingLeft";i.style[E]=`${n}px`}},resetAdjustments(e=t()){let{relatedElement:i}=e;i.style.paddingLeft="",i.style.paddingRight=""},getConfig(){let e=t(),i={...u,...e};return s("wecodeart.interactive.config",i,NAME)},validateConfig:()=>g(NAME,f.getConfig(),r(NAMESPACE))}});