import{store as e,getContext as t,getElement as i,getConfig as n,withScope as s}from"@wordpress/interactivity";const{hooks:{applyFilters:o}}=wp,{fn:{reflow:r,isRTL:a,isVisible:d,isDisabled:l,executeAfterTransition:c,validateConfig:g},Events:p,Backdrop:u,FocusTrap:m,Selector:f,ScrollBar:h}=wecodeart,w="modal",b=`wecodeart/${w}`,v=`.${`wp.${w}`}`,y="Escape",k=`hide${v}`,E=`hidePrevented${v}`,T=`hidden${v}`,A=`show${v}`,$=`shown${v}`,O="wp-modal-open",_="show",L="wp-modal--static",{state:B,actions:D,callbacks:C}=e(b,{state:{current:{},get isOpen(){const{isOpen:e}=B.current;return e}},actions:{toggle(){B.isOpen?D.hide(B.current):D.show()},show(){B.isOpen&&D.hide(B.current);const e=t();if(e.isOpen||e.isTransitioning)return;const{relatedElement:n}=e,{ref:o}=i();p.trigger(n,A,{relatedElement:o}).defaultPrevented||(e.isOpen=!0,e.isTransitioning=!0,B._scrollBar.hide(),document.body.classList.add(O),C.adjustDialog(e),e._backdrop.show(s(C.onShow)),B.current=e)},hide(e,i){B.current={};const n=e||t();if(!n.isOpen||n.isTransitioning)return;const{relatedElement:s}=n;p.trigger(s,k,{relatedTarget:i}).defaultPrevented||(n.isOpen=!1,n.isTransitioning=!0,n._focustrap.deactivate(),s.blur(),s.classList.remove(_),c((()=>C.onHide(n)),s,C.isAnimated(n)))}},callbacks:{onShow(){const e=t(),{relatedElement:i}=e;i.style.display="block",i.removeAttribute("aria-hidden"),i.setAttribute("aria-modal",!0),i.setAttribute("role","dialog"),i.scrollTop=0;const n=f.findOne(".wp-modal__body",C.getDialog());n&&(n.scrollTop=0),r(i),i.classList.add(_);const{focus:s}=C.getConfig();c((()=>{s&&e._focustrap.activate(),e.isTransitioning=!1,p.trigger(i,$)}),C.getDialog(),C.isAnimated())},onHide(e){const i=e||t(),{relatedElement:n}=i;n.style.display="none",n.setAttribute("aria-hidden",!0),n.removeAttribute("aria-modal"),n.removeAttribute("role"),i.isTransitioning=!1,i._backdrop.hide((()=>{document.body.classList.remove(O),C.resetAdjustments(i),B._scrollBar.reset(),p.trigger(n,T)}))},onResize(){const{current:{isOpen:e,isTransitioning:t}}=B;e&&!t&&C.adjustDialog(B.current)},onInit(){const{backdrop:e,keyboard:n}=C.getConfig(),{ref:s}=i(),o=t(),r=f.findOne(`#${s.getAttribute("aria-controls")}`);o.relatedElement=r,o._backdrop=new u({isVisible:Boolean(e),isAnimated:C.isAnimated(o)}),o._focustrap=new m({trapElement:r}),B._scrollBar=new h,p.on(r,`click.dismiss${v}`,`[data-wp-close="${w}"]`,(function(){l(this)||D.hide(o,this)})),p.on(r,`click.dismiss${v}`,(function({target:t}){r===t&&("static"!==e?e&&D.hide(o,"backdrop"):C.triggerBackdropTransition(o))})),p.on(r,`keydown.dismiss${v}`,(({key:e})=>{e===y&&(n?D.hide(o,y):C.triggerBackdropTransition(o))})),p.one(r,A,(e=>{e.defaultPrevented||p.one(r,T,(()=>{d(s)&&s.focus()}))})),o.isOpen&&(o.isOpen=!1,D.show(o))},triggerBackdropTransition(e=t()){B.current={};const{relatedElement:i}=e;if(p.trigger(i,E).defaultPrevented)return;const n=i.scrollHeight>document.documentElement.clientHeight,s=i.style.overflowY;"hidden"===s||i.classList.contains(L)||(n||(i.style.overflowY="hidden"),i.classList.add(L),c((()=>{i.classList.remove(L),c((()=>i.style.overflowY=s),C.getDialog(e))}),C.getDialog(e)),i.focus())},isAnimated(e=t()){const{relatedElement:i}=e;return i.classList.contains("fade")},getDialog(e=t()){const{relatedElement:i}=e;return f.findOne(".wp-modal__dialog",i)},adjustDialog(e=t()){const{relatedElement:i}=e,n=i.scrollHeight>document.documentElement.clientHeight,s=B._scrollBar.getWidth(),o=s>0;if(o&&!n){const e=a()?"paddingLeft":"paddingRight";i.style[e]=`${s}px`}if(!o&&n){const e=a()?"paddingRight":"paddingLeft";i.style[e]=`${s}px`}},resetAdjustments(e=t()){const{relatedElement:i}=e;i.style.paddingLeft="",i.style.paddingRight=""},getConfig:()=>{const e=t(),i={...B,...e};return o("wecodeart.interactive.config",i,w)},validateConfig:()=>g(w,C.getConfig(),n(b))}});