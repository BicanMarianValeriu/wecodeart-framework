import{store,getContext,getElement,getConfig,withScope}from"@wordpress/interactivity";let{applyFilters}=wp.hooks,{fn:{reflow,isRTL,isVisible,isDisabled,executeAfterTransition,validateConfig},Events,Backdrop,FocusTrap,Selector,ScrollBar}=wecodeart;const NAME="modal",NAMESPACE="wecodeart/"+NAME,DATA_KEY="wp."+NAME,EVENT_KEY="."+DATA_KEY,ESCAPE_KEY="Escape",EVENT_HIDE="hide"+EVENT_KEY,EVENT_HIDE_PREVENTED="hidePrevented"+EVENT_KEY,EVENT_HIDDEN="hidden"+EVENT_KEY,EVENT_SHOW="show"+EVENT_KEY,EVENT_SHOWN="shown"+EVENT_KEY,CLASS_NAME_OPEN="wp-modal-open",CLASS_NAME_FADE="fade",CLASS_NAME_SHOW="show",CLASS_NAME_STATIC="wp-modal--static",SELECTOR_DIALOG=".wp-modal__dialog",SELECTOR_BODY=".wp-modal__body";let{state,actions,callbacks}=store(NAMESPACE,{state:{current:{},get isOpen(){var e=state.current.isOpen;return e}},actions:{toggle(){state.isOpen?actions.hide(state.current):actions.show()},show(){state.isOpen&&actions.hide(state.current);var e,t,i=getContext();i.isOpen||i.isTransitioning||(e=i.relatedElement,t=getElement().ref,Events.trigger(e,EVENT_SHOW,{relatedElement:t}).defaultPrevented)||(i.isOpen=!0,i.isTransitioning=!0,state._scrollBar.hide(),document.body.classList.add(CLASS_NAME_OPEN),callbacks.adjustDialog(i),i._backdrop.show(withScope(callbacks.onShow)),state.current=i)},hide(e,t){state.current={};const i=e||getContext();!i.isOpen||i.isTransitioning||(e=i.relatedElement,Events.trigger(e,EVENT_HIDE,{relatedTarget:t}).defaultPrevented)||(i.isOpen=!1,i.isTransitioning=!0,i._focustrap.deactivate(),e.blur(),e.classList.remove(CLASS_NAME_SHOW),executeAfterTransition(()=>callbacks.onHide(i),e,callbacks.isAnimated(i)))}},callbacks:{onShow(){const e=getContext();let t=e.relatedElement;t.style.display="block",t.removeAttribute("aria-hidden"),t.setAttribute("aria-modal",!0),t.setAttribute("role","dialog"),t.scrollTop=0;var i=Selector.findOne(SELECTOR_BODY,callbacks.getDialog());i&&(i.scrollTop=0),reflow(t),t.classList.add(CLASS_NAME_SHOW);let s=callbacks.getConfig().focus;executeAfterTransition(()=>{s&&e._focustrap.activate(),e.isTransitioning=!1,Events.trigger(t,EVENT_SHOWN)},callbacks.getDialog(),callbacks.isAnimated())},onHide(e){const t=e||getContext();let i=t.relatedElement;i.style.display="none",i.setAttribute("aria-hidden",!0),i.removeAttribute("aria-modal"),i.removeAttribute("role"),t.isTransitioning=!1,t._backdrop.hide(()=>{document.body.classList.remove(CLASS_NAME_OPEN),callbacks.resetAdjustments(t),state._scrollBar.reset(),Events.trigger(i,EVENT_HIDDEN)})},onResize(){var{isOpen:e,isTransitioning:t}=state.current;e&&!t&&callbacks.adjustDialog(state.current)},onInit(){let{backdrop:t,keyboard:i}=callbacks.getConfig(),s=getElement().ref;const a=getContext(),n=Selector.findOne("#"+s.getAttribute("aria-controls"));a.relatedElement=n,a._backdrop=new Backdrop({isVisible:Boolean(t),isAnimated:callbacks.isAnimated(a)}),a._focustrap=new FocusTrap({trapElement:n}),state._scrollBar=new ScrollBar,Events.on(n,"click.dismiss"+EVENT_KEY,`[data-wp-close="${NAME}"]`,function(){isDisabled(this)||actions.hide(a,this)}),Events.on(n,"click.dismiss"+EVENT_KEY,function({target:e}){n===e&&("static"===t?callbacks.triggerBackdropTransition(a):t&&actions.hide(a,"backdrop"))}),Events.on(n,"keydown.dismiss"+EVENT_KEY,({key:e})=>{e===ESCAPE_KEY&&(i?actions.hide(a,ESCAPE_KEY):callbacks.triggerBackdropTransition(a))}),Events.one(n,EVENT_SHOW,e=>{e.defaultPrevented||Events.one(n,EVENT_HIDDEN,()=>{isVisible(s)&&s.focus()})}),a.isOpen&&(a.isOpen=!1,actions.show(a))},triggerBackdropTransition(e=getContext()){state.current={};let t=e.relatedElement;var i=Events.trigger(t,EVENT_HIDE_PREVENTED);if(!i.defaultPrevented){i=t.scrollHeight>document.documentElement.clientHeight;const s=t.style.overflowY;"hidden"===s||t.classList.contains(CLASS_NAME_STATIC)||(i||(t.style.overflowY="hidden"),t.classList.add(CLASS_NAME_STATIC),executeAfterTransition(()=>{t.classList.remove(CLASS_NAME_STATIC),executeAfterTransition(()=>t.style.overflowY=s,callbacks.getDialog(e))},callbacks.getDialog(e)),t.focus())}},isAnimated(e=getContext()){e=e.relatedElement;return e.classList.contains(CLASS_NAME_FADE)},getDialog(e=getContext()){e=e.relatedElement;return Selector.findOne(SELECTOR_DIALOG,e)},adjustDialog(e=getContext()){var t,e=e.relatedElement,i=e.scrollHeight>document.documentElement.clientHeight,s=state._scrollBar.getWidth(),a=0<s;a&&!i&&(t=isRTL()?"paddingLeft":"paddingRight",e.style[t]=s+"px"),!a&&i&&(t=isRTL()?"paddingRight":"paddingLeft",e.style[t]=s+"px")},resetAdjustments(e=getContext()){e=e.relatedElement;e.style.paddingLeft="",e.style.paddingRight=""},getConfig:()=>{var e=getContext(),e={...state,...e};return applyFilters("wecodeart.interactive.config",e,NAME)},validateConfig:()=>validateConfig(NAME,callbacks.getConfig(),getConfig(NAMESPACE))}});