import{store as e,getContext as t,getElement as i,getConfig as n,withScope as o}from"@wordpress/interactivity";let{hooks:{applyFilters:r}}=wp,{fn:{reflow:s,isRTL:E,isVisible:a,isDisabled:d,executeAfterTransition:l,validateConfig:g},Events:c,Backdrop:A,FocusTrap:N,Selector:S}=wecodeart,NAME="modal",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,ESCAPE_KEY="Escape",EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,CLASS_NAME_OPEN="wp-modal-open",CLASS_NAME_FADE="fade",CLASS_NAME_SHOW="show",CLASS_NAME_STATIC="wp-modal--static",SELECTOR_DIALOG=".wp-modal__dialog",SELECTOR_BODY=".wp-modal__body",{state:T,actions:u,callbacks:h}=e(NAMESPACE,{state:{current:{},get isShown(){let{isShown:f}=T.current;return f}},actions:{toggle(){T.isShown?u.hide(T.current):u.show()},show(){T.isShown&&u.hide(T.current);let e=t();if(e.isShown||e.isTransitioning)return;let{relatedElement:n}=e,{ref:r}=i(),s=c.trigger(n,EVENT_SHOW,{relatedElement:r});!s.defaultPrevented&&(e.isShown=!0,e.isTransitioning=!0,document.body.classList.add(CLASS_NAME_OPEN),h.adjustDialog(e),e._backdrop.show(o(h.onShow)),T.current=e)},hide(e){T.current={};let i=e||t();if(!i.isShown||i.isTransitioning)return;let{relatedElement:n}=i,o=c.trigger(n,EVENT_HIDE);!o.defaultPrevented&&(i.isShown=!1,i.isTransitioning=!0,i._focustrap.deactivate(),n.classList.remove(CLASS_NAME_SHOW),l(()=>h.onHide(i),n,h.isAnimated(i)))}},callbacks:{onShow(){let e=t(),{relatedElement:i}=e;i.style.display="block",i.removeAttribute("aria-hidden"),i.setAttribute("aria-modal",!0),i.setAttribute("role","dialog"),i.scrollTop=0;let n=S.findOne(".wp-modal__body",h.getDialog());n&&(n.scrollTop=0),s(i),i.classList.add(CLASS_NAME_SHOW);let{focus:o}=h.getConfig(),r=()=>{o&&e._focustrap.activate(),e.isTransitioning=!1,c.trigger(i,EVENT_SHOWN)};l(r,h.getDialog(),h.isAnimated())},onHide(e){let i=e||t(),{relatedElement:n}=i;n.style.display="none",n.setAttribute("aria-hidden",!0),n.removeAttribute("aria-modal"),n.removeAttribute("role"),i.isTransitioning=!1,i._backdrop.hide(()=>{document.body.classList.remove(CLASS_NAME_OPEN),h.resetAdjustments(i),c.trigger(n,EVENT_HIDDEN)})},onResize(){let{current:{isShown:e,isTransitioning:t}}=T;e&&!t&&h.adjustDialog(T.current)},onInit(){let{backdrop:e,keyboard:n}=h.getConfig(),{ref:o}=i(),r=t(),s=S.findOne(o.getAttribute("aria-controls"));r.relatedElement=s,r._backdrop=new A({isVisible:Boolean(e),isAnimated:h.isAnimated(r)}),r._focustrap=new N({trapElement:s}),c.on(s,`click.dismiss${EVENT_KEY}`,`[data-wp-close="${NAME}"]`,function(){!d(this)&&u.hide(r)}),c.on(s,`click.dismiss${EVENT_KEY}`,t=>{if(s===t.target){if("static"===e){h.triggerBackdropTransition(r);return}e&&u.hide(r)}}),c.on(s,`keydown.dismiss${EVENT_KEY}`,({key:e})=>{if("Escape"===e){if(n){u.hide(r);return}h.triggerBackdropTransition(r)}}),c.one(s,EVENT_SHOW,e=>{!e.defaultPrevented&&c.one(s,EVENT_HIDDEN,()=>{a(o)&&o.focus()})})},triggerBackdropTransition(e=t()){T.current={};let{relatedElement:i}=e,n=c.trigger(i,EVENT_HIDE_PREVENTED);if(n.defaultPrevented)return;let o=i.scrollHeight>document.documentElement.clientHeight,r=i.style.overflowY;!("hidden"===r||i.classList.contains(CLASS_NAME_STATIC))&&(o||(i.style.overflowY="hidden"),i.classList.add(CLASS_NAME_STATIC),l(()=>{i.classList.remove(CLASS_NAME_STATIC),l(()=>i.style.overflowY=r,h.getDialog(e))},h.getDialog(e)),i.focus())},isAnimated(e=t()){let{relatedElement:i}=e;return i.classList.contains("fade")},getDialog(e=t()){let{relatedElement:i}=e;return S.findOne(".wp-modal__dialog",i)},adjustDialog(e=t()){let{relatedElement:i}=e,n=i.scrollHeight>document.documentElement.clientHeight;if(!n){let o=E()?"paddingLeft":"paddingRight";i.style[o]="17px"}},resetAdjustments(e=t()){let{relatedElement:i}=e;i.style.paddingLeft="",i.style.paddingRight=""},getConfig(){let e=t(),i={...T,...e};return r("wecodeart.interactive.config",i,NAME)},validateConfig:()=>g(NAME,h.getConfig(),n(NAMESPACE))}});