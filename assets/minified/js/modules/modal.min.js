import{store as e,getContext as t,getElement as i,getConfig as n,withScope as r}from"@wordpress/interactivity";let{hooks:{applyFilters:s}}=wp,{fn:{reflow:o,isRTL:a,isVisible:E,isDisabled:d,executeAfterTransition:l,validateConfig:g},Events:c,Backdrop:A,FocusTrap:N,Selector:T,ScrollBar:p}=wecodeart,NAME="modal",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,ESCAPE_KEY="Escape",EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,CLASS_NAME_OPEN="wp-modal-open",CLASS_NAME_FADE="fade",CLASS_NAME_SHOW="show",CLASS_NAME_STATIC="wp-modal--static",SELECTOR_DIALOG=".wp-modal__dialog",SELECTOR_BODY=".wp-modal__body",{state:S,actions:u,callbacks:f}=e(NAMESPACE,{state:{current:{},get isOpen(){let{isOpen:h}=S.current;return h}},actions:{toggle(){S.isOpen?u.hide(S.current):u.show()},show(){S.isOpen&&u.hide(S.current);let e=t();if(e.isOpen||e.isTransitioning)return;let{relatedElement:n}=e,{ref:s}=i(),o=c.trigger(n,EVENT_SHOW,{relatedElement:s});!o.defaultPrevented&&(e.isOpen=!0,e.isTransitioning=!0,S._scrollBar.hide(),document.body.classList.add(CLASS_NAME_OPEN),f.adjustDialog(e),e._backdrop.show(r(f.onShow)),S.current=e)},hide(e,i){S.current={};let n=e||t();if(!n.isOpen||n.isTransitioning)return;let{relatedElement:r}=n,s=c.trigger(r,EVENT_HIDE,{relatedTarget:i});!s.defaultPrevented&&(n.isOpen=!1,n.isTransitioning=!0,n._focustrap.deactivate(),r.classList.remove(CLASS_NAME_SHOW),l(()=>f.onHide(n),r,f.isAnimated(n)))}},callbacks:{onShow(){let e=t(),{relatedElement:i}=e;i.style.display="block",i.removeAttribute("aria-hidden"),i.setAttribute("aria-modal",!0),i.setAttribute("role","dialog"),i.scrollTop=0;let n=T.findOne(".wp-modal__body",f.getDialog());n&&(n.scrollTop=0),o(i),i.classList.add(CLASS_NAME_SHOW);let{focus:r}=f.getConfig(),s=()=>{r&&e._focustrap.activate(),e.isTransitioning=!1,c.trigger(i,EVENT_SHOWN)};l(s,f.getDialog(),f.isAnimated())},onHide(e){let i=e||t(),{relatedElement:n}=i;n.style.display="none",n.setAttribute("aria-hidden",!0),n.removeAttribute("aria-modal"),n.removeAttribute("role"),i.isTransitioning=!1,i._backdrop.hide(()=>{document.body.classList.remove(CLASS_NAME_OPEN),f.resetAdjustments(i),S._scrollBar.reset(),c.trigger(n,EVENT_HIDDEN)})},onResize(){let{current:{isOpen:e,isTransitioning:t}}=S;e&&!t&&f.adjustDialog(S.current)},onInit(){let{backdrop:e,keyboard:n}=f.getConfig(),{ref:r}=i(),s=t(),o=T.findOne(r.getAttribute("aria-controls"));s.relatedElement=o,s._backdrop=new A({isVisible:Boolean(e),isAnimated:f.isAnimated(s)}),s._focustrap=new N({trapElement:o}),S._scrollBar=new p,c.on(o,`click.dismiss${EVENT_KEY}`,`[data-wp-close="${NAME}"]`,function(){!d(this)&&u.hide(s,this)}),c.on(o,`click.dismiss${EVENT_KEY}`,function({target:t}){if(o===t){if("static"===e){f.triggerBackdropTransition(s);return}e&&u.hide(s,"backdrop")}}),c.on(o,`keydown.dismiss${EVENT_KEY}`,({key:e})=>{if(e===ESCAPE_KEY){if(n){u.hide(s,ESCAPE_KEY);return}f.triggerBackdropTransition(s)}}),c.one(o,EVENT_SHOW,e=>{!e.defaultPrevented&&c.one(o,EVENT_HIDDEN,()=>{E(r)&&r.focus()})}),s.isOpen&&(s.isOpen=!1,u.show(s))},triggerBackdropTransition(e=t()){S.current={};let{relatedElement:i}=e,n=c.trigger(i,EVENT_HIDE_PREVENTED);if(n.defaultPrevented)return;let r=i.scrollHeight>document.documentElement.clientHeight,s=i.style.overflowY;!("hidden"===s||i.classList.contains(CLASS_NAME_STATIC))&&(r||(i.style.overflowY="hidden"),i.classList.add(CLASS_NAME_STATIC),l(()=>{i.classList.remove(CLASS_NAME_STATIC),l(()=>i.style.overflowY=s,f.getDialog(e))},f.getDialog(e)),i.focus())},isAnimated(e=t()){let{relatedElement:i}=e;return i.classList.contains("fade")},getDialog(e=t()){let{relatedElement:i}=e;return T.findOne(".wp-modal__dialog",i)},adjustDialog(e=t()){let{relatedElement:i}=e,n=i.scrollHeight>document.documentElement.clientHeight,r=S._scrollBar.getWidth(),s=r>0;if(s&&!n){let o=a()?"paddingLeft":"paddingRight";i.style[o]=`${r}px`}if(!s&&n){let E=a()?"paddingRight":"paddingLeft";i.style[E]=`${r}px`}},resetAdjustments(e=t()){let{relatedElement:i}=e;i.style.paddingLeft="",i.style.paddingRight=""},getConfig(){let e=t(),i={...S,...e};return s("wecodeart.interactive.config",i,NAME)},validateConfig:()=>g(NAME,f.getConfig(),n(NAMESPACE))}});