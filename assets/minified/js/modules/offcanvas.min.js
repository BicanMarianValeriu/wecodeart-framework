import{store as e,getContext as t,getElement as E,getConfig as i,withScope as r}from"@wordpress/interactivity";let{hooks:{applyFilters:n}}=wp,{fn:{isDisabled:a,executeAfterTransition:o,validateConfig:l},Events:s,Backdrop:d,FocusTrap:g,ScrollBar:N,Selector:c}=wecodeart,NAME="offcanvas",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,ESCAPE_KEY="Escape",EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,{state:f,actions:h,callbacks:T}=e(NAMESPACE,{state:{},actions:{toggle(){let e=t();e.isOpen?h.hide(e):h.show(e)},show(e=t()){if(e.isOpen)return;let i=s.trigger(e.relatedElement,EVENT_SHOW,{relatedTarget:E().ref});if(i.defaultPrevented)return;let{classes:r,scroll:n}=T.getConfig();e._backdrop.show(),n||new N().hide(),e.relatedElement.setAttribute("aria-modal",!0),e.relatedElement.setAttribute("role","dialog"),e.relatedElement.classList.add(r?.showing),T.onShow(e.relatedElement),e.isOpen=!0},hide(e=t(),E){if(!1===e.isOpen)return;let i=s.trigger(e.relatedElement,EVENT_HIDE,{relatedTarget:E});if(i.defaultPrevented)return;let{classes:r}=T.getConfig();e._focustrap.deactivate(),e.relatedElement.blur(),e.relatedElement.classList.add(r?.hiding),e._backdrop.hide(),T.onHide(e.relatedElement),e.isOpen=!1}},callbacks:{onShow(e){let E=t(),{classes:i,scroll:r,backdrop:n}=T.getConfig();o(()=>{(!r||n)&&E._focustrap.activate(),e.classList.add(i?.show),e.classList.remove(i?.showing),s.trigger(e,EVENT_SHOWN)},e,!0)},onHide(e){let{classes:t,scroll:E}=T.getConfig();o(()=>{e.classList.remove(t?.show,t?.hiding),e.removeAttribute("aria-modal"),e.removeAttribute("role"),E||new N().reset(),s.trigger(e,EVENT_HIDDEN)},e,!0)},onInit(){let{backdrop:e,keyboard:i}=T.getConfig(),{ref:n}=E(),o=t(),l=c.findOne(`#${n.getAttribute("aria-controls")}`);o.relatedElement=l;let N=()=>{if("static"===e){s.trigger(l,EVENT_HIDE_PREVENTED);return}h.hide(o,"backdrop")};o._backdrop=new d({isVisible:Boolean(e),isAnimated:!0,rootElement:l.parentNode,clickCallback:Boolean(e)?r(N):null}),o._focustrap=new g({trapElement:l}),s.on(l,`click.dismiss${EVENT_KEY}`,`[data-wp-close="${NAME}"]`,function(){!a(this)&&h.hide(o,this)}),s.on(document,`keydown.dismiss${EVENT_KEY}`,({key:e})=>{if(e===ESCAPE_KEY){if(i){h.hide(o,ESCAPE_KEY);return}s.trigger(n,EVENT_HIDE_PREVENTED)}}),o.isOpen&&(o.isOpen=!1,h.show(o))},getConfig(){let e=t(),E={...f,...e};return n("wecodeart.interactive.config",E,NAME)},validateConfig:()=>l(NAME,T.getConfig(),i(NAMESPACE))}});