import{store as e,getContext as t,getElement as E,getConfig as i,withScope as r}from"@wordpress/interactivity";let{hooks:{applyFilters:n}}=wp,{fn:{isDisabled:a,executeAfterTransition:o,validateConfig:l},Events:s,Backdrop:d,FocusTrap:g}=wecodeart,NAME="offcanvas",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,ESCAPE_KEY="Escape",EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,{state:N,actions:c,callbacks:f}=e(NAMESPACE,{state:{},actions:{toggle(){let e=t();e.isOpen?c.hide(e):c.show(e)},show(e=t()){if(e.isOpen)return;let E=s.trigger(e.relatedElement,EVENT_SHOW);if(E.defaultPrevented)return;let{classes:i,scroll:r}=f.getConfig();e._backdrop.show(),e.relatedElement.setAttribute("aria-modal",!0),e.relatedElement.setAttribute("role","dialog"),e.relatedElement.classList.add(i?.showing),f.onShow(e.relatedElement),e.isOpen=!0},hide(e=t()){if(!1===e.isOpen)return;let E=s.trigger(e.relatedElement,EVENT_HIDE);if(E.defaultPrevented)return;let{classes:i}=f.getConfig();e._focustrap.deactivate(),e.relatedElement.blur(),e.relatedElement.classList.add(i?.hiding),e._backdrop.hide(),f.onHide(e.relatedElement),e.isOpen=!1}},callbacks:{onShow(e){let E=t(),{classes:i,scroll:r,backdrop:n}=f.getConfig();o(()=>{(!r||n)&&E._focustrap.activate(),e.classList.add(i?.show),e.classList.remove(i?.showing),s.trigger(e,EVENT_SHOWN)},e,!0)},onHide(e){let{classes:t,scroll:E}=f.getConfig();o(()=>{e.classList.remove(t?.show,t?.hiding),e.removeAttribute("aria-modal"),e.removeAttribute("role"),s.trigger(e,EVENT_HIDDEN)},e,!0)},onInit(){let{backdrop:e,keyboard:i}=f.getConfig(),{ref:n}=E(),o=t(),l=document.querySelector(n.getAttribute("aria-controls"));o.relatedElement=l;let N=()=>{if("static"===e){s.trigger(l,EVENT_HIDE_PREVENTED);return}c.hide()};o._backdrop=new d({isVisible:Boolean(e),isAnimated:!0,rootElement:l.parentNode,clickCallback:Boolean(e)?r(N):null}),o._focustrap=new g({trapElement:l}),s.on(l,`click.dismiss${EVENT_KEY}`,`[data-wp-close="${NAME}"]`,function(){!a(this)&&c.hide(o)}),s.on(document,`keydown.dismiss${EVENT_KEY}`,({key:e})=>{if("Escape"===e){if(i){c.hide(o);return}s.trigger(n,EVENT_HIDE_PREVENTED)}})},getConfig(){let e=t(),E={...N,...e};return n("wecodeart.interactive.config",E,NAME)},validateConfig:()=>l(NAME,f.getConfig(),i(NAMESPACE))}});