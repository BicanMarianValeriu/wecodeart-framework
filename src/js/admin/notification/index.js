/**
 * WeCodeArt Framework.
 *
 * WARNING: This file is part of the core WeCodeArt Framework. DO NOT edit this file under any circumstances.
 * Please do all modifications in the form of a child theme.
 *
 * @package 	WeCodeArt FrameWork
 * @subpackage 	Admin/Notifications
 * @copyright   Copyright (c) 2022, WeCodeArt Framework
 * @since 		3.8.1
 * @version		5.5.5
 */

import './../../../scss/admin/notification/notification.scss';

(function ($) {

	/**
	 * Handles admin notification dismiss/transients.
	 *
	 * @since 3.8.1
	 */
	Notification = {

		/**
		 * Initialize
		 *
		 * @since 	3.8.1
		 * @method 	init
		 */
		init: function () {
			this._bind();
		},

		/**
		 * Binds events for notification buttons
		 *
		 * @since 	3.8.1
		 * @access 	private
		 * @method 	_bind
		 */
		_bind: () => {
			$(document).on('click', '[data-dismiss]', Notification._dismissNew);
			$(document).on('click', '.wca-notice .notice-dismiss', Notification._dismiss);
		},

		_dismiss: function (e) {
			e.preventDefault();
			const noticeId = $(this).parents('.wca-notice').attr('id') || '';
			Notification._ajax(noticeId);
		},

		_dismissNew: function (e) {
			e.preventDefault();

			const noticeId = $(this).parents('.wca-notice').attr('id') || '';

			const $el = $(this).parents('.wca-notice');

			$el.fadeTo(100, 0, () => $el.slideUp(100, () => $el.remove()));

			Notification._ajax(noticeId);

			const link = $(this).attr('href') || '';
			const target = $(this).attr('target') || '';

			if ('' !== link && '_blank' === target) {
				window.open(link, '_blank');
			}
		},

		_ajax: (notification) => {
			if ('' === notification) {
				return;
			}

			const container = document.getElementById(notification);
			const { nonce } = container.dataset;

			$.ajax({
				url: ajaxurl,
				type: 'POST',
				data: {
					action: 'wca_dismiss_notification',
					notification,
					nonce,
				},
			});
		}
	};

	$(() => Notification.init());
})(jQuery);