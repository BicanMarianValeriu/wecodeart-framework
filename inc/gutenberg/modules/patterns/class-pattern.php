<?php
/**
 * WeCodeArt Framework
 *
 * WARNING: This file is part of the core WeCodeArt Framework. DO NOT edit this file under any circumstances.
 * Please do all modifications in the form of a child theme.
 *
 * @package		WeCodeArt Framework
 * @subpackage  Gutenberg Pattern
 * @copyright   Copyright (c) 2021, WeCodeArt Framework
 * @since		5.0.0
 * @version		5.3.3
 */

namespace WeCodeArt\Gutenberg\Modules\Patterns;

defined( 'ABSPATH' ) || exit();

/**
 * Class representing a block pattern.
 */
class Pattern {
    /**
	 * Namespace: wecodeart
	 *
	 * @var string
	 */
    const NAMESPACE = 'wecodeart';

	/**
	 * Template slug.
	 *
	 * @var string
	 */
	public $slug;

	/**
	 * Title.
	 *
	 * @var string
	 */
	public $title = '';

	/**
	 * Content.
	 *
	 * @var string
	 */
	public $content = '';

	/**
	 * Description.
	 *
	 * @var string
	 */
	public $description = '';

    /**
	 * Categories.
	 *
	 * @var array
	 */
	public $categories = [];
    
	/**
	 * Block Types.
	 *
	 * @var array
	 */
	public $block_types = [];

	/**
	 * Theme.
	 *
	 * @var string
	 */
	public $theme;

	/**
	 * Source of the content.
	 *
	 * @var string
	 */
	public $source = 'theme';

    /**
     * Register Template
     *
     * @return void
     */
    public function register() {
		if ( \WP_Block_Patterns_Registry::get_instance()->is_registered( $this->get_name() ) ) return;
		
		$args = [
            'title'       => sanitize_text_field( $this->title ),
            'content'     => serialize_blocks( parse_blocks( $this->content ) ),
            'categories'  => ! empty( $this->categories ) ? array_map( 'sanitize_title', $this->categories ) : [ $this->theme ],
            'description' => sanitize_text_field( $this->description ),
        ];

		if( strpos( $this->get_name(), 'footer' ) ) {
			$args = wp_parse_args( [
				'blockTypes' => [ 'core/template-part/footer' ]
			], $args );
		}
		
		if( strpos( $this->get_name(), 'header' ) ) {
			$args = wp_parse_args( [
				'blockTypes' => [ 'core/template-part/header' ]
			], $args );
		}

		if( strpos( $this->get_name(), 'query' ) ) {
			$args = wp_parse_args( [
				'blockTypes' => [ 'core/query' ]
			], $args );
		}

        register_block_pattern( $this->get_name(), $args );
    }

	/**
     * Get Name
     *
     * @return string
     */
	public function get_name() {
		return join( '/', [ self::NAMESPACE, sanitize_text_field( $this->name ) ] );
	}
}
