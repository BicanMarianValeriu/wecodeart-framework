<?php namespace WeCodeArt\Core;
// Exit if accessed directly
if ( ! defined( 'ABSPATH' ) ) exit();
// Use
use WeCodeArt\Utilities\Form\Input as Inputs;
/**
 * WeCodeArt Framework.
 *
 * WARNING: This file is part of the core WeCodeArt Framework. DO NOT edit this file under any circumstances.
 * Please do all modifications in the form of a child theme.
 *
 * @package 	WeCodeArt Framework
 * @subpackage 	General Hooks
 * @since 		v3.0
 * @version		v3.5.0.2
 */

class Hooks {
	/**
	 * Instance
	 *
	 * @var $_instance
	 */
	private static $_instance = NULL;

	/**
	 * Initiator
	 *
	 * @since 	v3.3
	 * @return 	object
	 */
	public static function get_instance() {
		if( self::$_instance == NULL ) self::$_instance = new self;
		return self::$_instance;
	}

	/**
	 * Class Constructor.
	 */
	public function __construct() {
		add_filter( 'body_class',               array( $this, 'body_classes' ) );
		add_filter( 'post_class', 			  	array( $this, 'post_classes' ) );
		add_filter( 'comment_form_defaults',	array( $this, 'comment_form_defaults' ) );
		add_filter( 'get_custom_logo', 		 	array( $this, 'custom_logo' ) );
		add_action( 'get_search_form',          array( $this, 'search_form' ) );
	}
	
	/**
	 * Adds custom classes to the array of body classes.
	 *
	 * @param array $classes Classes for the body element.
	 * @return array
	 */
	public function body_classes( $classes ) {
		// Add a class of hfeed to non-singular pages.
		if ( ! is_singular() ) $classes[] = 'hfeed';
		
		// Adds a class of group-blog to blogs with more than 1 published author.
		if ( is_multi_author() ) $classes[] = 'group-blog';

		$has_sidebar = get_theme_mod( 'content-general-inner', array( 'content', 'primary' ) );
		// Page Has Sidebar
		$pages = get_pages();
		foreach( $pages as $page ) {		
			$ID = $page->ID;
			if( is_page( $ID ) ) $has_sidebar = get_theme_mod( 'content-general-inner-' . $ID, array( 'content', 'primary' ) );
		}

		if( in_array( 'primary', $has_sidebar ) ) $classes[] = 'has-sidebar';
		else $classes[] = 'no-sidebar';

		// Return Classes
		return $classes;
	}
	
	/**
	 * Filter the Custom Logo markup.
	 *
	 * @return html
	 */
	public function custom_logo() {
		$custom_logo_id = get_theme_mod( 'custom_logo' );
		$html = sprintf( '<a href="%1$s" class="custom-logo-link" rel="home" itemprop="url">%2$s</a>',
            esc_url( home_url( '/' ) ),
            wp_get_attachment_image( $custom_logo_id, 'full', false, array(
                'class'	=> 'custom-logo',
				'alt'	=> get_bloginfo( 'name' )
            ) )
        );
		
		return $html;	
	}
	
	/**
	 * Filter classes to the array of post classes.
	 *
	 * @param 	array $classes Classes for the post.
	 * @return 	array
	 */
	public function post_classes( $classes ) {
		if ( is_admin() ) return $classes;
		
		// Add "entry" to the post class array
		$classes[] = 'entry';
		// Remove "hentry" from post class array
		$classes = array_diff( $classes, array( 'hentry' ) );
		
		return $classes;
	}
	
	/**
	 * Filter Search form HTML Markup.
	 * @version v3.5.0.2
	 * @return 	string $form
	 */
	public function search_form( $args = array() ) {
		// Set the Defaults
		$defaults = array(
			'sr_text'	=> __( 'Search this website', 'wecodeart' ),
			'input' => [
				'id'		=> uniqid( 'searchform-' ),
				'placeholder'	=> get_search_query() ? apply_filters( 'the_search_query', get_search_query() ) : __( 'Enter keyword', 'wecodeart' ) . ' &#x02026;',
				'v_or_h'		=> ( get_search_query() == '' ) ? 'placeholder' : 'value',
			],
			'button' 	=> [
				'label' => __( 'Search', 'wecodeart' ),
				'class' => 'button'
			]
		);
		
		$args = wp_parse_args( $args, apply_filters( 'wecodeart/filter/search_form/defaults', $defaults ) );
		
		$form  = sprintf( '<form class="search-form" role="search" method="get" action="%s">', esc_url( home_url( '/' ) ) );
		$form .= sprintf( '<label class="show-for-sr" for="%1s">%2s</label>', $args['input']['id'], esc_html( $args['sr_text']  ) );	
		$form .= sprintf( '<div class="input-group">');		
		$form .= sprintf( '<input class="input-group-field" type="search" name="s" id="%1s" %s="%2s" required=""/>', 
			$args['input']['id'], 
			$args['input']['v_or_h'], 
			$args['input']['placeholder'] 
		);
		$form .= sprintf( '<div class="input-group-button"><button type="submit" class="%s">%s</button></div>', 
			esc_attr( $args['button']['class'] ),
			$args['button']['label']
		);
		$form .= sprintf( '</div>');
		$form .= sprintf( '</form>');
		
		// Return The Form with everything in it
		return apply_filters( 'wecodeart/filter/search_form/html', $form );
	}
	
	/**
	 * Filter Comment Respond Args.
	 *
	 * @version	3.2.1
	 * @return 	array
	 */
	public function comment_form_defaults( array $defaults ) {
		// Fields escapes all the data for us. 	
		$commenter = wp_get_current_commenter();
		$req       = get_option( 'require_name_email' );
		
		$author_name	= '<div class="comment-form-author cell medium-7">' .
			Inputs::compile( 'text', __( 'Name *', 'wecodeart' ), array( 
				'id' 	=> 'author',
				'name' 	=> 'author', 
				'required' 	=> ( $req ) ? 'required' : NULL, 
				'size' 		=> absint( 30 ), 
				'maxlength' => absint( 245 ),
				'value' 	=> $commenter['comment_author'] 
				) 
			)
		. '</div>';
		
		$author_email	= '<div class="comment-form-email cell medium-7">' .
			Inputs::compile( 'email', __( 'Email *', 'wecodeart' ), array( 			
				'id' 	=> 'email',
				'name' 	=> 'email',
				'required' 	=> ( $req ) ? 'required' : NULL, 
				'size' 		=> absint( 30 ), 
				'maxlength' => absint( 100 ),
				'value' 	=> $commenter['comment_author_email'] 
				)
			) 
		. '</div>';
		
		$author_url		= '<div class="comment-form-url cell medium-7">' .
			Inputs::compile( 'url', __( 'Website', 'wecodeart' ), array( 
				'id' 	=> 'url',
				'name' 	=> 'url',
				'size' 		 => absint( 30 ), 
				'maxlength'  => absint( 200 ),
				'value' 	 => $commenter['comment_author_url'] 
				)
			) 
		. '</div>';

		$author_comment		= '<div class="comment-form-comment cell medium-12">' .
			Inputs::compile( 'textarea', __( 'Comment*', 'wecodeart' ), array( 
				'id' 	=> 'comment',
				'name' 	=> 'comment',
				'rows'	=> absint( 8 ), 
				'cols'  => absint( 45 ),
				'required' 		 => 'true', 
				'aria-required'  => 'true' 
				)
			) 
		. '</div>';
		
		$args = array(
			'title_reply' 	=> __( 'Speak Your Mind', 'wecodeart' ),
			'comment_field' => $author_comment,
			'fields' 		=> array(
				'author' => $author_name,
				'email'  => $author_email,
				'url'    => $author_url,
			)
		);

		// Merge $args with $defaults
		$args = wp_parse_args( $args, $defaults );

		// Return filterable array of $args, along with other optional variables
		return apply_filters( 'wecodeart/filter/comment_form_args', $args, $commenter, $req);

	}
}